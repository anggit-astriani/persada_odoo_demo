<?xml version="1.0" encoding="UTF-8" ?>
<templates id="template" xml:space="preserve">

    <!-- Dashboard Map Template -->
    <t t-name="custom_module.CustomerMapDashboard" owl="1">
        <div class="o_customer_map_dashboard" style="height: 100vh; padding: 0; margin: 0;">
            <!-- Loading Overlay -->
            <div t-if="state.loading" class="d-flex justify-content-center align-items-center h-100"
                 style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); z-index: 1000;">
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                        <span class="sr-only">Loading...</span>
                    </div>
                    <div class="mt-3">
                        <h5>Loading Customer Map...</h5>
                        <p class="text-muted">Please wait while we load your customer locations</p>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div t-if="state.errorMessage" class="alert alert-danger m-3" role="alert">
                <h4 class="alert-heading">
                    <i class="fa fa-exclamation-triangle"/> Map Error
                </h4>
                <p t-esc="state.errorMessage"/>
                <hr/>
                <p class="mb-0">
                    <button class="btn btn-outline-danger" t-on-click="() => window.location.reload()">
                        <i class="fa fa-refresh"/> Reload Page
                    </button>
                </p>
            </div>

            <!-- Main Map Container -->
            <div t-if="!state.errorMessage" class="h-100 position-relative">
                <!-- Map Header Info -->
                <div class="position-absolute" style="top: 10px; left: 10px; z-index: 1000;">
                    <div class="card shadow-sm">
                        <div class="card-body p-2">
                            <h6 class="card-title mb-1">
                                <i class="fa fa-users text-primary"/> Customer Locations
                            </h6>
                            <small class="text-muted">
                                <span t-if="state.customerCount > 0" t-esc="state.customerCount"/>
                                <span t-if="state.customerCount === 1">location</span>
                                <span t-if="state.customerCount !== 1">locations</span>
                                <span t-if="state.customerCount === 0">No locations found</span>
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="position-absolute" style="top: 10px; right: 10px; z-index: 1000;">
                    <div class="btn-group-vertical" role="group">
                        <button class="btn btn-primary btn-sm" t-on-click="addNewCustomer" title="Add New Customer">
                            <i class="fa fa-plus"/>
                        </button>
                        <button class="btn btn-secondary btn-sm" t-on-click="refreshData" title="Refresh Data"
                                t-att-disabled="state.loading">
                            <i class="fa fa-refresh" t-att-class="{'fa-spin': state.loading}"/>
                        </button>
                    </div>
                </div>

                <!-- Map Canvas -->
                <div t-ref="mapContainer" class="w-100 h-100" style="background-color: #f8f9fa;">
                    <!-- Fallback content for when Leaflet is not loaded -->
                    <div class="d-flex justify-content-center align-items-center h-100 text-muted" t-if="!state.loading and state.customerCount === 0">
                        <div class="text-center">
                            <i class="fa fa-map-o fa-4x mb-3"/>
                            <h4>No Customer Locations</h4>
                            <p>Start by adding customers with location data</p>
                            <button class="btn btn-primary" t-on-click="addNewCustomer">
                                <i class="fa fa-plus"/> Add First Customer
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Map Legend -->
                <div class="position-absolute" style="bottom: 10px; left: 10px; z-index: 1000;">
                    <div class="card shadow-sm" style="max-width: 200px;">
                        <div class="card-body p-2">
                            <h6 class="card-title mb-2">
                                <i class="fa fa-info-circle"/> Legend
                            </h6>
                            <div class="d-flex align-items-center mb-1">
                                <div style="width: 16px; height: 16px; background: #1f77b4; border-radius: 50%; margin-right: 8px;"></div>
                                <small>Active Customer</small>
                            </div>
                            <div class="d-flex align-items-center">
                                <div style="width: 16px; height: 16px; background: #6c757d; border-radius: 50%; margin-right: 8px;"></div>
                                <small>Inactive Customer</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <!-- Map Picker Field Widget Template -->
    <t t-name="custom_module.MapPickerWidget" owl="1">
        <div class="o_map_picker_container">
            <!-- Coordinate Input Row -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Latitude</label>
                    <input type="number"
                           class="form-control"
                           t-model="state.latitude"
                           t-on-change="onLatitudeChange"
                           step="0.000001"
                           min="-90"
                           max="90"
                           placeholder="-6.200000"/>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Longitude</label>
                    <input type="number"
                           class="form-control"
                           t-model="state.longitude"
                           t-on-change="onLongitudeChange"
                           step="0.000001"
                           min="-180"
                           max="180"
                           placeholder="106.816666"/>
                </div>
            </div>

            <!-- Map Controls Row -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary btn-sm" t-on-click="updateMapFromInputs">
                        <i class="fa fa-map-marker"/> Update Map
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" t-on-click="getCurrentLocation">
                        <i class="fa fa-location-arrow"/> My Location
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" t-on-click="centerOnLocation">
                        <i class="fa fa-crosshairs"/> Center
                    </button>
                </div>
                <button type="button" class="btn btn-outline-danger btn-sm" t-on-click="clearLocation">
                    <i class="fa fa-trash"/> Clear
                </button>
            </div>

            <!-- Interactive Map -->
            <div class="o_map_picker">
                <div t-ref="mapContainer" class="map-picker-canvas"></div>
            </div>

            <!-- Help Text -->
            <div class="alert alert-info mt-3" role="alert">
                <small>
                    <i class="fa fa-info-circle"/>
                    Click on the map to set location, or use the coordinate inputs above.
                    You can also drag existing markers to adjust the position.
                </small>
            </div>
        </div>
    </t>

</templates>